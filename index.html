<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Portfolio | Owen Kelley</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
  <nav>
    <ul>
      <li><a href="#/home" data-route="home">Home</a></li>
      <li><a href="#/projects" data-route="projects">Projects</a></li>
    </ul>
  </nav>
</header>

<main>
  <!-- HOME PAGE (intro only) -->
  <div class="page home-page" data-page="home">
    <section id="intro">
      <div class="centered-container">
        <div class="intro-text" id="introText">
          <div class="intro-lines">
            <div class="intro-line small">
              <span id="hiLine"></span>
              <span class="caret" aria-hidden="true"></span>
            </div>
          
            <div class="intro-line big" id="bigLine">
              <span class="name-spot">
                <span id="nameLine" class="aurora-text"></span>
              </span>
            </div>                     
          </div>
          
        </div>
      </div>
    </section>
  </div>

  <!-- PROJECTS PAGE (isolated) -->
  <div class="page projects-page" data-page="projects">
    <section id="projects" class="anchor" aria-label="Projects">
      <div class="projects-pin">
        <div class="pinner" id="projectsPinner">
          <div class="section-head">
            <h2 style="margin:0 0 6px 0;">Projects</h2>
            <p style="margin:0;color:var(--muted);font-size:.95rem;">Scroll to step through projects. The page continues after the last one.</p>
          </div>
          <div class="carousel" id="projectsCarousel" aria-live="polite">
            <div class="track" role="group" aria-roledescription="carousel" aria-label="Project slides (vertical)">
              <!-- Slide 1 -->
              <article class="slide" role="group" aria-label="ADFS + Duo MFA Integration">
                <div class="project-card">
                  <div class="project-header">
                    <h3>ADFS + Duo MFA Integration</h3>
                    <p class="project-desc">Deployed a .NET app for Windows endpoints, integrating ADFS with Duo MFA to harden authentication with minimal user friction.</p>
                    <div class="tags"><span class="tag">C#</span><span class="tag">.NET</span><span class="tag">ADFS</span><span class="tag">Duo</span><span class="tag">Security</span></div>
                    <div class="divider"></div>
                    <ul class="bullets">
                      <li>Reduced risky sign-ins by 42% post rollout.</li>
                      <li>Graceful fallbacks for offline devices.</li>
                      <li>Automated installer & health checks.</li>
                    </ul>
                  </div>
                  <div class="project-media"><span>Image / GIF</span></div>
                </div>
              </article>
              <!-- Slide 2 -->
              <article class="slide" role="group" aria-label="Active Directory Auth Gateway">
                <div class="project-card">
                  <div class="project-header">
                    <h3>Active Directory Auth Gateway</h3>
                    <p class="project-desc">Azure gateway VM intercepting Kerberos/NTLM to apply conditional access and 2FAâ€”no agents on domain controllers.</p>
                    <div class="tags"><span class="tag">Azure</span><span class="tag">Networking</span><span class="tag">Kerberos</span><span class="tag">NTLM</span></div>
                    <div class="divider"></div>
                    <ul class="bullets">
                      <li>WFP-based port inspection & policy engine.</li>
                      <li>Per-request Duo prompt with allow/deny.</li>
                      <li>Traffic shaping for lab replay tests.</li>
                    </ul>
                  </div>
                  <div class="project-media"><span>Diagram</span></div>
                </div>
              </article>
              <!-- Slide 3 -->
              <article class="slide" role="group" aria-label="Fitness Tracking App">
                <div class="project-card">
                  <div class="project-header">
                    <h3>Fitness Tracking App</h3>
                    <p class="project-desc">SwiftUI mobile app to create and track workouts, integrating WHOOP data to adjust training intensity dynamically.</p>
                    <div class="tags"><span class="tag">SwiftUI</span><span class="tag">iOS</span><span class="tag">Health APIs</span></div>
                    <div class="divider"></div>
                    <ul class="bullets">
                      <li>Workout builder with sets/reps/weights.</li>
                      <li>Zone-based trends & auto-adjustments.</li>
                      <li>Clean, offline-first local store.</li>
                    </ul>
                  </div>
                  <div class="project-media"><span>App Screens</span></div>
                </div>
              </article>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<footer>
  <p>&copy; 2025 Owen Kelley</p>
</footer>

<script>
  // ===== Role Typewriter (subtitle) =====
  (function(){
    const hiEl   = document.getElementById('hiLine');
    const nameEl = document.getElementById('nameLine');
    if(!hiEl || !nameEl) return;

    const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const HI   = "Hi, my name is";
    const NAME = "Owen.";    // keep your period if you want it
    const TYPE = 125;        // slow it down if you like

    function typeTo(el, text, i = 0, done){
      if (reduce) { el.textContent = text; done && done(); return; }
      el.textContent = text.slice(0, i);
      if (i < text.length) setTimeout(() => typeTo(el, text, i + 1, done), TYPE);
      else done && done();
    }

    function startTyping(){
      typeTo(hiEl, HI, 0, () => {
        document.querySelector('.intro-line.small .caret')?.remove();   // remove small caret

        // Slight pause, then set text and fade the big line in
        setTimeout(() => {
          nameEl.textContent = NAME;
          (document.getElementById('bigLine') || document.querySelector('.intro-line.big'))?.classList.add('show');
        }, 300);
      });
    }

    let started = false;
    function kick(){
      if (started) return;
      if ((location.hash || '#/home') === '#/projects') return;
      started = true;
      startTyping();
    }

    // Start ONLY after the overlay reveals
    window.addEventListener('hero-revealed', kick, { once: true });
  })();

  // === Helpers ===
  function getHeaderH(){
    const v = getComputedStyle(document.documentElement).getPropertyValue('--headerH').trim();
    const n = parseFloat(v);
    return isNaN(n) ? 80 : n;
  }
  function smoothScrollTo(y){ window.scrollTo({ top: y, behavior: 'smooth' }); }

  // === Simple hash router (#/home, #/projects) ===
  (function(){
    const pages = {
      home: document.querySelector('.home-page'),
      projects: document.querySelector('.projects-page')
    };
    const navLinks = Array.from(document.querySelectorAll('nav a'));
    let homeSpyObserver = null;
    let projectsInitialized = false;

    function setNavActive(which){
      navLinks.forEach(a => {
        const r = a.getAttribute('data-route');
        a.classList.toggle('active', r === which || (which!== 'projects' && r === 'home' && which === 'home-spy'));
      });
    }

    // Scroll spy for home page (intro only)
    function initHomeSpy(){
      if(homeSpyObserver) homeSpyObserver.disconnect();
      const ids = ['intro'];
      const headerH = getHeaderH();
      homeSpyObserver = new IntersectionObserver((entries)=>{
        entries.forEach(entry => { if(entry.isIntersecting){
          const id = entry.target.id;
          navLinks.forEach(a=>{
            const r = a.getAttribute('data-route');
            const match = (id==='intro' && r==='home');
            a.classList.toggle('active', match);
          });
        }});
      }, { root: null, threshold: 0.55, rootMargin: `-${headerH}px 0px -40% 0px` });
      ids.forEach(id => { const el = document.getElementById(id); if(el) homeSpyObserver.observe(el); });
    }

    function showPage(which){
      pages.home.classList.toggle('active', which !== 'projects');
      pages.projects.classList.toggle('active', which === 'projects');

      if(which === 'projects'){
        if(homeSpyObserver) homeSpyObserver.disconnect();
        setNavActive('projects');
        if(!projectsInitialized){ initProjectsPage(); projectsInitialized = true; }
        sizeProjectsPin();
      } else {
        initHomeSpy();
        smoothScrollTo(0);
      }
    }

    function parseRoute(){
      const hash = location.hash || '#/home';
      const m = hash.match(/^#\/(.*)$/);
      const r = m ? m[1] : 'home';
      if(['home','projects'].includes(r)) return r;
      return 'home';
    }

    window.addEventListener('hashchange', ()=> showPage(parseRoute()));
    document.addEventListener('DOMContentLoaded', ()=> showPage(parseRoute()));
  })();

  // === Projects page logic ===
  function sizeProjectsPin() {
    const pinner = document.getElementById('projectsPinner');
    if(!pinner) return;
    const pinWrap = pinner.parentElement;
    const slides = document.querySelectorAll('#projectsCarousel .slide').length;
    if (!pinWrap || !slides) return;
    const hh = getHeaderH();
    const perSlide = Math.max(1, window.innerHeight - hh);
    pinWrap.style.minHeight = (perSlide * slides + 0.5) + 'px';
  }
  window.addEventListener('resize', sizeProjectsPin);
  document.addEventListener('DOMContentLoaded', sizeProjectsPin);

  function initVerticalCarousel(root){
    const track = root.querySelector('.track');
    const slides = Array.from(root.querySelectorAll('.slide'));
    let index = 0;

    function update(){
      track.style.transform = `translateY(${-index * 100}%)`;
      slides.forEach((s,i)=> s.setAttribute('aria-hidden', i!==index));
    }
    function goTo(i){ index = Math.max(0, Math.min(slides.length-1, i)); update(); }
    function prev(){ goTo(index-1); }
    function next(){ goTo(index+1); }

    let startY = 0, currY = 0, dragging = false;
    const py = (e)=> e.touches? e.touches[0].clientY : e.clientY;
    function onDown(e){ dragging=true; startY=py(e); currY=startY; track.style.transition='none'; }
    function onMove(e){ if(!dragging) return; currY=py(e); const dy=currY-startY; track.style.transform = `translateY(calc(${-index*100}% + ${dy}px))`; }
    function onUp(){ if(!dragging) return; dragging=false; track.style.transition=''; const dy=currY-startY; const threshold=Math.min(140, window.innerHeight*0.18); if(dy>threshold) prev(); else if(dy<-threshold) next(); else update(); }

    track.addEventListener('pointerdown', onDown);
    window.addEventListener('pointermove', onMove);
    window.addEventListener('pointerup', onUp);
    track.addEventListener('touchstart', onDown, {passive:true});
    window.addEventListener('touchmove', onMove, {passive:true});
    window.addEventListener('touchend', onUp);

    window.addEventListener('resize', update);
    update();

    return { getIndex:()=>index, getLast:()=>slides.length-1, goNext:next, goPrev:prev };
  }

  function initProjectsPage(){
    const pinner = document.getElementById('projectsPinner');
    const carousel = document.getElementById('projectsCarousel');
    if(!pinner || !carousel) return;
    pinner.tabIndex = 0;
    const api = initVerticalCarousel(carousel);

    const track = carousel.querySelector('.track');
    let animating = false;
    track.addEventListener('transitionstart', ()=> { animating = true; });
    track.addEventListener('transitionend', ()=> { animating = false; setLocked(false); });

    const body = document.body;
    let wheelCooldown = false;
    let exiting = false;

    function setLocked(locked){ body.classList.toggle('no-scroll', locked); }

    const pinWrap = pinner.parentElement;
    function pinTop(){ return pinWrap.offsetTop; }
    function pinBottom(){ return pinWrap.offsetTop + pinWrap.offsetHeight; }

    const io = new IntersectionObserver((entries)=>{
      if (!entries[0].isIntersecting) { setLocked(false); exiting = false; }
    }, { root: null, threshold: 0 });
    if (pinWrap) io.observe(pinWrap);

    function isPinnedFullscreen(){
      if (exiting) return false;
      const r = pinner.getBoundingClientRect();
      const vh = window.innerHeight;
      const hh = getHeaderH();
      const topAligned = r.top <= (hh + 10);
      const botAligned = r.bottom >= (vh - 10);
      return topAligned && botAligned;
    }

    function snapOut(direction){
      exiting = true;
      setLocked(false);
      const hh = getHeaderH();
      const y = direction === 'down'
        ? (pinBottom() - window.innerHeight + 2)
        : Math.max(0, pinTop() - hh - 2);
      smoothScrollTo(y);
      setTimeout(()=> { exiting = false; }, 400);
    }

    function handleWheel(e){
      if(!document.querySelector('.projects-page').classList.contains('active')) return;
      if(!isPinnedFullscreen()) { setLocked(false); return; }
      if (animating) { e.preventDefault(); return; }
      const atFirst = api.getIndex() === 0;
      const atLast  = api.getIndex() === api.getLast();
      const dy = e.deltaY;

      if ((dy > 0 && !atLast) || (dy < 0 && !atFirst)) {
        e.preventDefault();
        if (wheelCooldown) return;
        wheelCooldown = true;
        setLocked(true);
        dy > 0 ? api.goNext() : api.goPrev();
        setTimeout(()=> wheelCooldown = false, 380);
      } else if (dy > 0 && atLast) {
        e.preventDefault();
        snapOut('down');
      } else if (dy < 0 && atFirst) {
        e.preventDefault();
        snapOut('up');
      }
    }
    pinner.addEventListener('wheel', handleWheel, { passive: false });

    // Touch scroll -> slide (with snapOut at edges)
    let touchStartY = 0, touchCurrY = 0, touching = false;
    function tStart(e){ touching = true; touchStartY = e.touches[0].clientY; touchCurrY = touchStartY; }
    function tMove(e){ if(!touching) return; touchCurrY = e.touches[0].clientY; }
    function tEnd(){
      if(!touching) return; touching = false;
      if(!document.querySelector('.projects-page').classList.contains('active')) return;
      if(!isPinnedFullscreen()) { setLocked(false); return; }
      const dy = touchStartY - touchCurrY;
      const threshold = Math.min(90, window.innerHeight * 0.12);
      const atFirst = api.getIndex() === 0;
      const atLast  = api.getIndex() === api.getLast();
      if (dy > threshold && !atLast) { setLocked(true); api.goNext(); }
      else if (dy < -threshold && !atFirst) { setLocked(true); api.goPrev(); }
      else if (dy > 0 && atLast) { snapOut('down'); }
      else if (dy < 0 && atFirst) { snapOut('up'); }
      else { setLocked(false); }
    }
    pinner.addEventListener('touchstart', tStart, { passive: true });
    pinner.addEventListener('touchmove', tMove, { passive: true });
    pinner.addEventListener('touchend', tEnd);

    // Keyboard support with snapOut
    pinner.addEventListener('keydown', (e)=>{
      if(!document.querySelector('.projects-page').classList.contains('active')) return;
      if(!isPinnedFullscreen()) return;
      const atFirst = api.getIndex() === 0;
      const atLast  = api.getIndex() === api.getLast();
      if(e.key === 'PageDown' || e.key === 'ArrowDown') {
        if(!atLast) { e.preventDefault(); setLocked(true); api.goNext(); }
        else { e.preventDefault(); snapOut('down'); }
      }
      if(e.key === 'PageUp' || e.key === 'ArrowUp') {
        if(!atFirst) { e.preventDefault(); setLocked(true); api.goPrev(); }
        else { e.preventDefault(); snapOut('up'); }
      }
    });
  }
</script>
<script>
  /* Minimal key-only overlay */
  (function(){
    if ((location.hash || '#/home') === '#/projects') return;
  
    var reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  
    var overlay = document.createElement('div');
    overlay.className = 'intro-overlay';
    overlay.innerHTML =
      '<div class="sq-wrap" tabindex="0" role="button" aria-label="Enter site">'+
        '<div class="square" aria-hidden="true"><span class="keyhole" aria-hidden="true"></span></div>'+
      '</div>'+
      '<div class="white-wipe" aria-hidden="true"></div>';
    document.body.appendChild(overlay);
  
    var sq  = overlay.querySelector('.square');
    var kh  = overlay.querySelector('.keyhole');
    var wr  = overlay.querySelector('.sq-wrap');
    var introText = document.querySelector('.home-page #intro .intro-text');
  
    function revealPage(){
      overlay.classList.add('revealing');
      var wipe = overlay.querySelector('.white-wipe');
      if (wipe){
        requestAnimationFrame(function(){ wipe.style.transform = 'translateY(0%)'; });
        wipe.addEventListener('transitionend', function(){
          overlay.classList.add('hidden');
          if (introText) introText.classList.add('show');
          window.dispatchEvent(new Event('hero-revealed'));
        }, { once:true });
      } else {
        overlay.classList.add('hidden');
        if (introText) introText.classList.add('show');
        window.dispatchEvent(new Event('hero-revealed'));
      }
    }
  
    function start(){
      if (reduce) { revealPage(); return; }
      sq.addEventListener('animationend', function(e){
      if (e.animationName === 'spin360'){
        wr.classList.add('lift');            // fade the key out
        requestAnimationFrame(revealPage);   // kick the white wipe immediately
      }
}, { once:true });

      sq.classList.add('spin');
      kh && kh.classList.add('spin');
    }
  
    wr.addEventListener('click', start);
    wr.addEventListener('keydown', function(e){
      if (e.key === 'Enter' || e.key === ' '){ e.preventDefault(); start(); }
    });
  
    if (reduce) revealPage();
  })();
  </script>  
</body>
</html>
